

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" >
<head><title>
	[请假表] 编辑记录
</title><meta http-equiv="Pragma" content="no-cache" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link type="text/css" rel="stylesheet" href="../../Css/kandytabs.css" /><link type="text/css" rel="stylesheet" href="../../Css/appInput.css" /><link type="text/css" rel="stylesheet" href="../../Editor/kindeditor-4.1.10/themes/default/default.css" />
    <script type="text/javascript" src="../../js/jquery-1.7.min.js"></script>
    <script type="text/javascript" src="../../DatePicker/WdatePicker.js"></script>
    <script type="text/javascript" src="../../js/lhgdialog.min.js"></script>
    <script type="text/javascript" src="../../js/kandytabs.pack.js"></script>
    <script type="text/javascript" src="../../Editor/kindeditor-4.1.10/kindeditor-min.js"></script>
    <script type="text/javascript" src="../../Editor/kindeditor-4.1.10/lang/zh_CN.js"></script>
    <script type="text/javascript" src="../../js/jquery.notice.js"></script>
    <script type="text/javascript" src="../../js/jquery.tablednd.0.8.min.js"></script>
    <script type="text/javascript" src="../../js/jquery.masked.js"></script>
    <script type="text/javascript" src="../../js/jquery.smartMenu.js"></script>
    <script src="../../Js/DateExt.js" type="text/javascript"></script>
    <script type='text/javascript' src='/TEST_Studio/Js/mailAutoComplete.js'></script><link type='text/css' rel='stylesheet' href='/TEST_Studio/Css/CustomStyle.css' />
    <style type="text/css">
        #bottomToolbar{
	        width:100%; height:40px; line-height:40px;
	        background:white url(../../img/common/topbar.gif); 
	        border-top:2px solid #708090;
	        position:fixed; bottom:0; left:0;
	        _position:absolute; 
        }
        #bottomToolbar a{ color:blue;}
        #maindiv{padding-bottom:50px;padding-top:20px;}
    </style>
</head>
<body>
    <form method="post" action="AppInput.aspx?para=9bB4zR2.CWKjtkWbjNk7FzoBoC0Y9pnqlC.1WjzoyKWbEnWy3r_5QpHfZSJfbGhUDlJx6Wu2L7UrVbv1C83B7giNAwQkGwJ3GU59cUvUxUS1CD4Cbdf1NSPxpy1WBsxAYT1a6beQ40E%3d" id="form1">
<div class="aspNetHidden">
<input type="hidden" name="__EVENTTARGET" id="__EVENTTARGET" value="" />
<input type="hidden" name="__EVENTARGUMENT" id="__EVENTARGUMENT" value="" />
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="tPE+W5VK1ANbcFcx6DGNQnGFiNP95ab9wNIE+qAqM4LwcbApBWdx3uNMFJE1yAdeaiCiNY/Uop+caI62439HMUBwGu4H4Cba/4jdXcM/QAgtyigp75MpjMwOW4iX7rw1/owBT6HBEPnaMXpCUj4Uieu9qOb6U7dL4GnV4GaC/9pALtvT27+ax35GN6sYgP1qqoCDb6NoWcDlPW4aQ7k3omt/H1PbwoLag0otaA==" />
</div>

<script type="text/javascript">
//<![CDATA[
var theForm = document.forms['form1'];
if (!theForm) {
    theForm = document.form1;
}
function __doPostBack(eventTarget, eventArgument) {
    if (!theForm.onsubmit || (theForm.onsubmit() != false)) {
        theForm.__EVENTTARGET.value = eventTarget;
        theForm.__EVENTARGUMENT.value = eventArgument;
        theForm.submit();
    }
}
//]]>
</script>



<script type="text/javascript" src="/TEST_Studio/ajaxpro/prototype.ashx"></script>
<script type="text/javascript" src="/TEST_Studio/ajaxpro/core.ashx"></script>
<script type="text/javascript" src="/TEST_Studio/ajaxpro/converter.ashx"></script>
<script type="text/javascript" src="/TEST_Studio/ajaxpro/EIS.WebBase.SysFolder.AppFrame.AppInput,EIS.WebBase.ashx"></script>

<div class="aspNetHidden">

	<input type="hidden" name="__EVENTVALIDATION" id="__EVENTVALIDATION" value="oQX8QJ+pI5NSLU/stebVLoww1NYEu/xTRIp3oqnqB+LmwqJJ5lkmGVFYs55ggHrzAgw7tE9uoRA5LnH82/36hN5x+LkHOW2YUKmWp1RdJyC+5PisgE352V3aoy8=" />
</div>
    <!-- 工具栏 -->
    <div class="menubar">
        <div class="topnav">
            <span style="right:10px;display:inline;float:right;position:fixed;line-height:30px;top:0px;">
                <a class='linkbtn' href="javascript:" onclick="_appSaveAdd();" id="btnSaveAdd" name="btnSaveAdd">保存后新增</a>
				<em class="split">|</em>
                <a class='linkbtn' href="javascript:" onclick="_appSave();"  id="btnSave" name="btnSave">保存</a>
                <em class="split" style="">|</em>
                <a id="btnStartWF" href="javascript:__doPostBack(&#39;btnStartWF&#39;,&#39;&#39;)" style="display:;">发起流程</a>
				<em class="split">|</em>
                <a class='linkbtn' style="" href="javascript:" onclick="_appDirection();"  id="btnDirection" name="btnDirection">填报说明</a>
				<em class="split">|</em>
                <a class='linkbtn' href="javascript:" onclick="_appClose();" id="btnClose" name="btnClose">关闭</a>
            </span>
        </div>
    </div>
    
    </form>
    
    <div id="maindiv">
    <style><!--
    #maindiv
    {
        width: 900px;
    }
    #input014
    {
        border: 0px solid gray;
        border-bottom: 1px solid black;
        color: blue;
        width: 96px;
        float: none;
        padding: 0px 0px 2px 0px;
        height: 16px;
    }
--></style>
<div style="text-align: right; line-height: 30px; height: 30px;">申请单号:<input class='TextBoxInChar Read OA_QINGJIA_QHNO'  readonly  type='text' name='input014' id='input014' maxlength='40' title="最多输入40个字符"  value="QJ1601080004"  /></div>
<table align="center" class="normaltbl" border="1"><caption class=" " style="background: #D6E8FC;"><span>因公外出登记表</span></caption>
<tbody>
<tr>
<td width="15%" class="normaltbltd">申请人</td>
<td width="35%"><input class='TextBoxInChar Read OA_QINGJIA_EMPLOYNAME'  readonly  type='text' name='input01' id='input01' maxlength='40' title="最多输入40个字符"  value="王志强"  /></td>
<td width="15%" class="normaltbltd">申请工号</td>
<td width="35%"><input class='TextBoxInChar Read OA_QINGJIA_EMPLOYN0'  readonly  type='text' name='input02' id='input02' maxlength='40' title="最多输入40个字符"  value="04046"  /></td>
</tr>
<tr>
<td width="15%" class="normaltbltd">科室</td>
<td width="35%" colspan="3"><input class='TextBoxInChar Read OA_QINGJIA_DEPTNAME'  readonly  type='text' name='input04' id='input04' maxlength='128' title="最多输入128个字符"  value="教育处"  /></td>
</tr>
<tr>
<td class="normaltbltd">外出时间</td>
<td><table border=0 width='96px' class='RequiredTbl'><tr><td><input class='Wdate TextBoxInDate OA_QINGJIA_STARTDATE' style="width:80px;" onfocus="WdatePicker({ dateFmt:'yyyy-MM-dd HH:mm',doubleCalendar:false,onpicked:_datePicked});" type='text' value='2016-01-08 15:12' id='input05' name='input05'   /></td><td class='RequiredStar'>*</td></tr></table>至 <table border=0 width='96px' class='RequiredTbl'><tr><td><input class='Wdate TextBoxInDate OA_QINGJIA_ENDDATE' style="width:80px;" onfocus="WdatePicker({ dateFmt:'yyyy-MM-dd HH:mm',doubleCalendar:false,onpicked:_datePicked});" type='text' value='2016-01-11 15:12' id='input06' name='input06'   /></td><td class='RequiredStar'>*</td></tr></table><table border=0 width='100%' class='RequiredTbl'><tr><td><input class='TextBoxInChar OA_QINGJIA_CALCULATESUM'   type='text' name='input024' id='input024' maxlength='50' title="最多输入50个字符"  value="1天1小时"  /></td><td class='RequiredStar'>*</td></tr></table></td>
<td class="normaltbltd">外出地点</td>
<td><table border=0 width='100%' class='RequiredTbl'><tr><td><input class='TextBoxInChar OA_QINGJIA_APDESC'   type='text' name='input09' id='input09' maxlength='100' title="最多输入100个字符"  value=""  /></td><td class='RequiredStar'>*</td></tr></table></td>
</tr>
<tr>
<td class="normaltbltd">显示寒暑假</td>
<td>应有寒暑假:<input class='TextBoxInChar Read OA_QINGJIA_YYEARDATE'  readonly  type='text' name='input019' id='input019' data-type='float' precision='1' maxlength='5' title="请输入数值，最多输入4位,保留1位小数" value="15.0"  /><br />剩余寒暑假:<input class='TextBoxInChar Read OA_QINGJIA_SYEARDATE'  readonly  type='text' name='input020' id='input020' maxlength='50' title="最多输入50个字符"  value="12天5小时"  /></td>
<td class="normaltbltd">外出期间工作安排是否妥当</td>
<td><table border=0 width='100%' class='RequiredTbl'><tr><td><input type='radio' class='Radio OA_QINGJIA_WCLOCATION'       checked value='是' name='input013' id='input013_0' /><label for='input013_0'>是</label>&nbsp;<input type='radio' class='Radio OA_QINGJIA_WCLOCATION'        value='否' name='input013' id='input013_1' /><label for='input013_1'>否</label>&nbsp;</td><td class='RequiredStar'>*</td></tr></table></td>
</tr>
<tr></tr>
<tr>
<td class="normaltbltd">外出事由</td>
<td colspan="3"><table border=0 width='100%' class='RequiredTbl'><tr><td><select  id='input07' name='input07'    class='DropDownIn OA_QINGJIA_QJTYPE' ><option selected value="">请选择---</option><option value='开会'>开会</option><option value='培训'>培训</option><option value='其他'>其他</option></select></td><td class='RequiredStar'>*</td></tr></table></td>
</tr>
<tr>
<td class="normaltbltd">情况说明</td>
<td colspan="5"><table border=0 width='100%' class='RequiredTbl'><tr><td><input class='TextBoxInChar OA_QINGJIA_USERDESC'   type='text' name='input08' id='input08' maxlength='300' title="最多输入300个字符"  value="1"  /></td><td class='RequiredStar'>*</td></tr></table></td>
</tr>
</tbody>
</table>
<div class="hidden" style="clear: both;"><input class='TextBoxInChar OA_QINGJIA_HEADTYPE'   type='text' name='input012' id='input012' maxlength='256' title="最多输入256个字符"  value="个人请（休）假"  /><input class='TextBoxInChar Read OA_QINGJIA_EMPLOYN0'  readonly  type='text' name='input02' id='input02' maxlength='40' title="最多输入40个字符"  value="04046"  /><input class='TextBoxInChar Read OA_QINGJIA_DEPTID'  readonly  type='text' name='input03' id='input03' maxlength='50' title="最多输入50个字符"  value="309"  /><input class='TextBoxInChar OA_QINGJIA_MARK'   type='text' name='input026' id='input026' maxlength='50' title="最多输入50个字符"  value=""  /></div>
<script type='text/javascript'>

</script>
    </div>
    <!-- 底部工具栏
    <div id="bottomToolbar">
        <button type="button" id="btnSubmit" class="btn01" onclick="_appSubmit();">&nbsp;提 交&nbsp;</button>&nbsp;
        <button type="button" id="btnSave"  class="btn01" onclick="_appSave();">&nbsp;保 存&nbsp;</button>&nbsp;
        <button type="button" id="btnClose" class="btn01" onclick="javascript:window.close();">&nbsp;关 闭&nbsp;</button>
    </div>
    -->
</body>
</html>
    <script type="text/javascript">
        $("dl").KandyTabs({ trigger: "click" });
        jQuery(function(){
            $(".btn01").hover(function(){
                this.className="btn02";
            },function(){
                this.className="btn01";
            });
            if(!_isNew)
            {
                jQuery("#btnSaveAdd").prev().andSelf().hide();
            }
            /*
            $(window).resize(function(){
                $("#maindiv").height($(document.body).height()-75);
            });
            $("#maindiv").height($(document.body).height()-75);
            */
            $("#btnStartWF").click(_appStartWF);
		});


        //保存数据
        function _appSave()
        {   
            //平台保存函数
            var safe = false;
            try {safe = _sysSave();} catch (err) {alert("提交过程中出现异常：" + err.message + "\r\n请尝试重新提交，或者联系管理员。");}

            if(safe)
            { 
                $.noticeAdd({ text: '保存成功！',stayTime:500,onClose:function(){

                    if(!!frameElement){
                        if(!!frameElement.lhgDG){
                            frameElement.lhgDG.curWin.app_query("OA_QINGJIA");
                            frameElement.lhgDG.cancel();
                        }
                        else{
                	        try { window.opener.app_query("OA_QINGJIA"); } catch (e) {}
	                        window.close();
                        }
                    }
                    else{
                	    try { window.opener.app_query("OA_QINGJIA"); } catch (e) {}
	                    window.close();
                    }

                }});

            }
        }

        //刷新关联主表列表
        function app_query(tName){
            var listHtml = _curClass.GetListHtml("OA_QINGJIA",tName,_mainId,_sIndex).value;
            $("#"+tName).before(listHtml).remove();
        }

        //保存数据,发起流程
        function _appSubmit()
        {
            if(!confirm("您确认提交审批吗?")){
                return false;
            }

            var safe = false;
            try { safe = _sysSave(); } catch (err) {alert("提交过程中出现异常：" + err.message+"\r\n请尝试重新提交，或者联系管理员。");}

            if(safe)
            { 
                var url = "";
                
                if(''=='2'){
                    __doPostBack('btnStartWF','');
                }
                else{
                    if("" == ""){
                        url = "../Workflow/SelectWorkFlow.aspx?tblName=OA_QINGJIA&mainId=19d23d04-f4a6-4ef0-aebb-f8075ada157a";
                        window.location.href=url;
                    }
                    else{
                        url = "../workflow/NewFlow.aspx?workflowCode=&mainId=19d23d04-f4a6-4ef0-aebb-f8075ada157a";
                        window.location.href=url;
                    }
                }


            }
        }

        //保存数据,发起流程
        function _appStartWF()
        {
            if(!confirm("您确认提交审批吗?")){
                return false;
            }   
            //平台保存函数
            if(_sysSave())
            { 
                var url = "";
                if("" == ""){
                    if(''=='2'){
                        return true;
                    }
                    else{
                        url = "../Workflow/SelectWorkFlow.aspx?tblName=OA_QINGJIA&mainId=19d23d04-f4a6-4ef0-aebb-f8075ada157a";
                        window.location.href=url;
                        return false;
                    }
                }
                else{
                    url = "../workflow/NewFlow.aspx?workflowCode=&mainId=19d23d04-f4a6-4ef0-aebb-f8075ada157a";
                    window.location.href=url;
                }

            }
            else{
                return false;
            }
        }

        //查询填报说明
        function _appDirection() {
            var dlg = new $.dialog({ title: '[请假表] 填报说明', page: 'AppDirection.aspx?tblName=OA_QINGJIA'
                , btnBar: true, cover: true, lockScroll: true, width: 800, height: 600, bgcolor: 'gray', cancelBtnTxt: '关闭',
                onCancel: function () {
                }
            });
            dlg.ShowDialog();
        }

        //保存数据，新增
        function _appSaveAdd()
        {   
            //平台保存函数
            if(_sysSave())
            {
                try { window.opener.app_query();} catch (e) {}
                window.location.href = window.location.href;
            }
        }
        //返回列表
        function _appBack(){
            window.history.back();
        }
        //关闭窗口
        function _appClose(){
            if(!!frameElement){
                if(!!frameElement.lhgDG)
                    frameElement.lhgDG.cancel();
                else
                    window.close();
            }
            else{
                window.close();
            }
        }
        var _curClass =EIS.WebBase.SysFolder.AppFrame.AppInput;
        var _isNew = false;
        var _mainTblName = "OA_QINGJIA";
        var _mainId = "19d23d04-f4a6-4ef0-aebb-f8075ada157a";
        var _sIndex = "";
        var _saveAction = "1";
        var _workflowCode ="";
        var _nodeCode ="";
        var _nodeId ="";
        var _sysModel=[{'tablename':'OA_QINGJIA','fields':[
	{'name' : 'EMPLOYNAME', 'type' : '1', 'length' : '40', 'order': '1','empty':'0','namecn' : '姓名','dispstyle' : '', 'limit':'1'},
	{'name' : 'EMPLOYN0', 'type' : '1', 'length' : '40', 'order': '2','empty':'0','namecn' : '工号','dispstyle' : '', 'limit':'1'},
	{'name' : 'DEPTID', 'type' : '1', 'length' : '50', 'order': '3','empty':'0','namecn' : '科室id','dispstyle' : '', 'limit':'1'},
	{'name' : 'DEPTNAME', 'type' : '1', 'length' : '128', 'order': '4','empty':'0','namecn' : '科室名称','dispstyle' : '', 'limit':'1'},
	{'name' : 'STARTDATE', 'type' : '4', 'length' : '', 'order': '5','empty':'1','namecn' : '开始时间','dispstyle' : '001', 'limit':'1'},
	{'name' : 'ENDDATE', 'type' : '4', 'length' : '', 'order': '6','empty':'1','namecn' : '结束时间','dispstyle' : '001', 'limit':'1'},
	{'name' : 'QJTYPE', 'type' : '1', 'length' : '40', 'order': '7','empty':'1','namecn' : '请假类型','dispstyle' : '013', 'limit':'1'},
	{'name' : 'USERDESC', 'type' : '1', 'length' : '300', 'order': '8','empty':'1','namecn' : '情况说明','dispstyle' : '', 'limit':'1'},
	{'name' : 'APDESC', 'type' : '1', 'length' : '100', 'order': '9','empty':'1','namecn' : '外出地点','dispstyle' : '', 'limit':'1'},
	{'name' : 'TASKID', 'type' : '1', 'length' : '40', 'order': '10','empty':'0','namecn' : 'taskid','dispstyle' : '', 'limit':'1'},
	{'name' : 'PROCESSID', 'type' : '1', 'length' : '40', 'order': '11','empty':'0','namecn' : '流程id','dispstyle' : '', 'limit':'1'},
	{'name' : 'HEADTYPE', 'type' : '1', 'length' : '256', 'order': '12','empty':'0','namecn' : '类型','dispstyle' : '', 'limit':'1'},
	{'name' : 'WCLOCATION', 'type' : '1', 'length' : '128', 'order': '13','empty':'1','namecn' : '工作是否安排妥当','dispstyle' : '041', 'limit':'1'},
	{'name' : 'QHNO', 'type' : '1', 'length' : '40', 'order': '14','empty':'0','namecn' : '申请单号','dispstyle' : '', 'limit':'1'},
	{'name' : 'STATUS', 'type' : '2', 'length' : '', 'order': '15','empty':'0','namecn' : '状态','dispstyle' : '', 'limit':'1'},
	{'name' : 'CREATEDATE', 'type' : '4', 'length' : '', 'order': '16','empty':'1','namecn' : '创建时间','dispstyle' : '', 'limit':'1'},
	{'name' : 'WORKNAME', 'type' : '1', 'length' : '50', 'order': '17','empty':'0','namecn' : '工作名称','dispstyle' : '', 'limit':'1'},
	{'name' : 'DATESUM', 'type' : '3', 'length' : '12,1', 'order': '18','empty':'0','namecn' : '请假总时间','dispstyle' : '', 'limit':'1'},
	{'name' : 'YYEARDATE', 'type' : '3', 'length' : '4,1', 'order': '19','empty':'0','namecn' : '寒暑假总天数','dispstyle' : '', 'limit':'1'},
	{'name' : 'SYEARDATE', 'type' : '1', 'length' : '50', 'order': '20','empty':'0','namecn' : '剩余寒暑假','dispstyle' : '', 'limit':'1'},
	{'name' : 'DATELENGT', 'type' : '1', 'length' : '100', 'order': '21','empty':'0','namecn' : '时长','dispstyle' : '', 'limit':'1'},
	{'name' : 'TXJTYPE', 'type' : '1', 'length' : '20', 'order': '22','empty':'0','namecn' : '调休类型','dispstyle' : '', 'limit':'1'},
	{'name' : 'QINGJIASUM', 'type' : '1', 'length' : '100', 'order': '23','empty':'0','namecn' : '请假总数','dispstyle' : '', 'limit':'1'},
	{'name' : 'CALCULATESUM', 'type' : '1', 'length' : '50', 'order': '24','empty':'1','namecn' : '请假时长','dispstyle' : '', 'limit':'1'},
	{'name' : 'DO', 'type' : '1', 'length' : '50', 'order': '25','empty':'0','namecn' : '操作','dispstyle' : '', 'limit':'1'},
	{'name' : 'MARK', 'type' : '1', 'length' : '50', 'order': '26','empty':'0','namecn' : '标识','dispstyle' : '', 'limit':'1'},
	{'name' : 'DEPUTY', 'type' : '1', 'length' : '50', 'order': '27','empty':'0','namecn' : '相关工作代理人','dispstyle' : '', 'limit':'1'},
	{'name' : 'CHOOSEDZBPLANID', 'type' : '1', 'length' : '1000', 'order': '28','empty':'0','namecn' : '选中的值班计划id','dispstyle' : '', 'limit':'1'},
	{'name' : 'THISYEAR', 'type' : '1', 'length' : '50', 'order': '29','empty':'0','namecn' : '当前年份','dispstyle' : '', 'limit':'1'},
	{'name' : 'LASTYEAR', 'type' : '1', 'length' : '50', 'order': '30','empty':'0','namecn' : '上一年份','dispstyle' : '', 'limit':'1'},
	{'name' : 'YYEARDATELY', 'type' : '3', 'length' : '4,1', 'order': '31','empty':'0','namecn' : '上一年寒暑假总天数','dispstyle' : '', 'limit':'1'},
	{'name' : 'SYEARDATELY', 'type' : '1', 'length' : '50', 'order': '32','empty':'0','namecn' : '上一年剩余寒暑假','dispstyle' : '', 'limit':'1'},
	{'name' : 'NEXTYEAR', 'type' : '1', 'length' : '50', 'order': '33','empty':'0','namecn' : '下一年份','dispstyle' : '', 'limit':'1'},
	{'name' : 'YYEARDATENY', 'type' : '3', 'length' : '4,1', 'order': '34','empty':'0','namecn' : '下一年寒暑假总天数','dispstyle' : '', 'limit':'1'},
	{'name' : 'SYEARDATENY', 'type' : '1', 'length' : '50', 'order': '35','empty':'0','namecn' : '下一年剩余寒暑假','dispstyle' : '', 'limit':'1'}],
'subtbls':[
	{'tablename':'OA_QINGJIA_DETAIL','maxorder':0, 'limit':'1', 'fields':[
	{'name' : 'DAYS', 'type' : '2', 'length' : '', 'order': '1','empty':'0','namecn' : '天数','dispstyle' : '', 'limit':'1'},
	{'name' : 'TYPE', 'type' : '1', 'length' : '5', 'order': '2','empty':'0','namecn' : '类型','dispstyle' : '', 'limit':'1'},
	{'name' : 'YEARDATE', 'type' : '4', 'length' : '', 'order': '3','empty':'0','namecn' : '日期','dispstyle' : '', 'limit':'1'}]},
	{'tablename':'OA_QINGJIA_ZBTX','maxorder':0, 'limit':'1', 'fields':[
	{'name' : 'ZBPLANID', 'type' : '1', 'length' : '50', 'order': '1','empty':'0','namecn' : '值班记录ID','dispstyle' : '', 'limit':'1'},
	{'name' : 'LEAVEHOURS', 'type' : '1', 'length' : '50', 'order': '3','empty':'0','namecn' : '调休小时数','dispstyle' : '', 'limit':'1'},
	{'name' : 'ZBDATE', 'type' : '1', 'length' : '50', 'order': '4','empty':'0','namecn' : '值班日期','dispstyle' : '', 'limit':'1'},
	{'name' : 'AREANAME', 'type' : '1', 'length' : '50', 'order': '5','empty':'0','namecn' : '院区','dispstyle' : '', 'limit':'1'},
	{'name' : 'ZBTYPE', 'type' : '1', 'length' : '50', 'order': '6','empty':'0','namecn' : '类型','dispstyle' : '', 'limit':'1'},
	{'name' : 'ZBBC', 'type' : '1', 'length' : '50', 'order': '7','empty':'0','namecn' : '班次','dispstyle' : '', 'limit':'1'},
	{'name' : 'EMPNAME', 'type' : '1', 'length' : '50', 'order': '8','empty':'0','namecn' : '值班人员姓名','dispstyle' : '', 'limit':'1'},
	{'name' : 'SIGNMANNAME', 'type' : '1', 'length' : '50', 'order': '9','empty':'0','namecn' : '签到人员姓名','dispstyle' : '', 'limit':'1'}]},
	{'tablename':'OA_QINGJIA_SUMMERLEAVE','maxorder':0, 'limit':'1', 'fields':[
	{'name' : 'SUMMERLEAVEID', 'type' : '1', 'length' : '50', 'order': '1','empty':'0','namecn' : '寒暑假ID','dispstyle' : '', 'limit':'1'},
	{'name' : 'LEAVEDAYS', 'type' : '2', 'length' : '', 'order': '2','empty':'0','namecn' : '休假日期','dispstyle' : '', 'limit':'1'}]}
]}];
        var _xmlData =jQuery(jQuery.parseXML('<xml><root><Table TableName="OA_QINGJIA" Sindex=""><row id="" state="Unchanged"><_AutoID><![CDATA[19d23d04-f4a6-4ef0-aebb-f8075ada157a]]></_AutoID><_UserName><![CDATA[b0a509bc-cbff-4599-9bdf-6772d87b64a3]]></_UserName><_OrgCode><![CDATA[00020]]></_OrgCode><_CreateTime><![CDATA[2016/1/8 15:11:19]]></_CreateTime><_UpdateTime><![CDATA[2016/1/8 15:11:19]]></_UpdateTime><_IsDel><![CDATA[0]]></_IsDel><_CompanyID><![CDATA[6A5DF65B-F037-4EF8-B4E2-9EF8B19C0339]]></_CompanyID><_WFState><![CDATA[处理中]]></_WFState><_GDState><![CDATA[]]></_GDState><_WFCurNode /><_WFCurUser /><EMPLOYNAME><![CDATA[王志强]]></EMPLOYNAME><EMPLOYN0><![CDATA[04046]]></EMPLOYN0><DEPTID><![CDATA[309]]></DEPTID><DEPTNAME><![CDATA[教育处]]></DEPTNAME><STARTDATE><![CDATA[2016-01-08 15:12]]></STARTDATE><ENDDATE><![CDATA[2016-01-11 15:12]]></ENDDATE><QJTYPE><![CDATA[寒暑假]]></QJTYPE><USERDESC><![CDATA[1]]></USERDESC><APDESC><![CDATA[]]></APDESC><TASKID><![CDATA[]]></TASKID><PROCESSID><![CDATA[]]></PROCESSID><HEADTYPE><![CDATA[个人请（休）假]]></HEADTYPE><WCLOCATION><![CDATA[是]]></WCLOCATION><QHNO><![CDATA[QJ1601080004]]></QHNO><STATUS><![CDATA[1]]></STATUS><CREATEDATE><![CDATA[]]></CREATEDATE><WORKNAME><![CDATA[]]></WORKNAME><DATESUM><![CDATA[]]></DATESUM><YYEARDATE><![CDATA[15.0]]></YYEARDATE><SYEARDATE><![CDATA[12天5小时]]></SYEARDATE><DATELENGT><![CDATA[]]></DATELENGT><TXJTYPE><![CDATA[]]></TXJTYPE><QINGJIASUM><![CDATA[]]></QINGJIASUM><CALCULATESUM><![CDATA[1天1小时]]></CALCULATESUM><DO><![CDATA[]]></DO><MARK><![CDATA[]]></MARK><DEPUTY><![CDATA[]]></DEPUTY><CHOOSEDZBPLANID><![CDATA[]]></CHOOSEDZBPLANID><THISYEAR><![CDATA[2016]]></THISYEAR><LASTYEAR><![CDATA[2015]]></LASTYEAR><YYEARDATELY><![CDATA[0.0]]></YYEARDATELY><SYEARDATELY><![CDATA[0天]]></SYEARDATELY><NEXTYEAR><![CDATA[2017]]></NEXTYEAR><YYEARDATENY><![CDATA[0.0]]></YYEARDATENY><SYEARDATENY><![CDATA[0天]]></SYEARDATENY></row></Table></root></xml>'));
    </script>
    <script src="../../Js/SysFunction.js?v=635790396545939010" type="text/javascript"></script>
    <script type="text/javascript">
        jQuery(function () {
    $(".topnav,.wfheader").css("background", "url(../../Img/rmyy/bk.png)");
    dateChange();
    qj_ygwc();
    if (isPositiveDirector()) {
        $(".chiefline").show();
    }
    if (_sIndex == "4") {
        $("#input07_8").css({ "margin-left": "100px" });
        $("input:radio[name='input07']").change(function () { qjtype(); }).change();
        //$("input:radio[name='input07']").click(function () { qjtype(); });
        $("input:radio[name='input022']").change(function () { zzb(); });
        //$("input:radio[name='input022']").click(function () { zzb(); });
        loadqjtype();
    }
    SummerLeave();
    $("#input08").keyup(function () {
        if (this.value.length > 300)
            this.value = this.value.substr(0, 300);
    });
});

function qjtype() {
    var val = $('input:radio[name="input07"]:checked').val();
    if (!!val) {
        if (val == "调休假") {
            $("#zzb").css({ "display": "block", "margin-left": "500px" });
            if (_isNew) { 
                $("input[name=input022][value='总值班']").prop("checked", 'checked');
                $("input:radio[name='input022'][value='总值班']").change();
            }
            else {
                $("#OA_QINGJIA_ZBTX").show();
            }
            //$("#input022_0").click();
        }
        else {
            $("#zzb").hide();
            $("#OA_QINGJIA_ZBTX").hide();
        }
    }
}

function loadqjtype() {
    var val = $('input:radio[name="input07"]:checked').val();
    if (!!val) {
        if (val == "调休假") {
            $("#zzb").css({ "display": "block", "margin-left": "500px" });
            $("#OA_QINGJIA_ZBTX").show();
        }
        else {
            $("#zzb").hide();
            $("#OA_QINGJIA_ZBTX").hide();
        }
    }
}

function zzb() {
    var val = $('input:radio[name="input022"]:checked').val();
    if (!!val) {
        if (val == "总值班") {
            if (!!$("#input05").val() && !!$("#input06").val()) {
                var arr = window.showModalDialog("../../WorkAsp/Select/Qingjia/Select_ZBPLANLIST.aspx?tblName=Q_QJ_TX_ZBPlan&condition=" + getTXCondition(), window, "dialogHeight=700px;dialogWidth=1000px;status:no;fullscreen:no;");
                $("#input028").val(arr);
                _fnSubDelAll('OA_QINGJIA_ZBTX');//删除子表数据                 
                //生成调休明细表                 
                var keys = [];
                var beginYmd = $("#input05").val().substring(0, 10);
                keys.push("@_MainID=" + _mainId);
                keys.push("@_qjdate=" + beginYmd);
                keys.push("@choosedzbplanid=" + $("#input028").val());
                var dt = _curClass.GetDataTable("select_zbtx_detail", keys.join("|")).value;
                for (var j = 0; j < dt.Rows.length; j++) {
                    var dr = dt.Rows[j];
                    //如果选择的值班记录已过期或未生效，不能提交，提示重新选择
                    if (dr.isvalid == "0") {
                        alert("您选择的总值班记录在您请假的日期未生效或已过期！请重新选择！");
                        return false;
                    }
                    var newIndex = _fnSubAdd("OA_QINGJIA_ZBTX");
                    $("#SubTbl01_" + newIndex + "_1").val(dr._AutoID);
                    $("#SubTbl01_" + newIndex + "_5").val(dr.areaname);
                    $("#SubTbl01_" + newIndex + "_6").val(dr.zbtype);
                    $("#SubTbl01_" + newIndex + "_4").val(dr.zbdate);
                    $("#SubTbl01_" + newIndex + "_7").val(dr.zbbc);
                    $("#SubTbl01_" + newIndex + "_8").val(dr.empname);
                    $("#SubTbl01_" + newIndex + "_9").val(dr.signmanname);
                    if (dr.hours != 0) {
                        $("#SubTbl01_" + newIndex + "_3").val(dr.hours.toString());
                    }
                }
                $("#OA_QINGJIA_ZBTX").show();
            }
            else {
                alert("请输入请假开始和结束时间！");
                $("#OA_QINGJIA_ZBTX").hide();
            }
        }
    }
}
function getTXCondition() {
    var sql = new Array();
    sql.push("ZBDate  between dateadd(day,-31,cast('" + $("#input05").val() + "' as DATE)) and dateadd(day,-1,cast('" + $("#input05").val() + "' as DATE))");
    return escape(sql.join("").replace(/'/gi, "[QUOTES]"));
}
function qj_ygwc()   //因公外出自动生成单据号 
{
    if (_sIndex == "4") {
        $("#input012").val("个人请（休）假");
        $("#input015").val(1);
    }
    else {
        $("#input012").val("因公外出");
        $("#input015").val(1);
    }
}
function qjNo() {
    var valnumtemp = "QJ";
    var keys = [];
    keys.push("@cglx=" + valnumtemp);
    keys.push("@num=4");
    var no = _curClass.ExecSQL("select_qj_no", keys.join("|")).value;
    $("#input014").val(no).css("color", "blue");
    //再次触发任务名称change事件     
    jQuery("row:first", _xmlData).find("QHNO").text(no);
    $("#input014").change();
}
function dateChange() {
    /*if (_nodeCode != "A1") {
        return;
    }*/
    jQuery("#input05")[0].onfocus = function () {
        return WdatePicker({ maxDate: '#F{$dp.$D(\'input06\')}', minDate: '2015-09-01 00:00', dateFmt: 'yyyy-MM-dd HH:mm',onpicked:_datePicked });
    };
    jQuery("#input06")[0].onfocus = function () {
        if (!!$("#input05").val()) {
            return WdatePicker({ minDate: '#F{$dp.$D(\'input05\')}', dateFmt: 'yyyy-MM-dd HH:mm' ,onpicked:_datePicked});
        }
        else {
            return WdatePicker({ minDate: '2015-09-01 00:00', dateFmt: 'yyyy-MM-dd HH:mm',onpicked:_datePicked });
        }
    };
    //$("#input05").bind("propertychange", function () {
    $("#input05").change(function () {
        if (!!$("#input05").val()) {
            qjSum();
        }
    });
    //$("#input06").bind("propertychange", function () {
    $("#input06").change( function () {
        if (!!$("#input06").val()) {
            qjSum();
        }
    });
}
function qjSum() {
    if (!!$("#input05").val()) {
        if (!!$("#input06").val()) {
            var startDate = $("#input05").val();
            var endDate = $("#input06").val();
            var keys = [];
            keys.push("@num1=" + 1);
            keys.push("@num2=" + 8);
            keys.push("@begintimeStr=" + startDate);
            keys.push("@endtimeStr=" + endDate);
            var empNo = '';
            var no = _curClass.ExecSQL("select_qjSum", keys.join("|")).value;
            //是否是肝病研究所管理单元的组员             
            var UserNo = _curClass.ExecSQL("select_yjs", "@EmpNo=" + empNo).value;
            //var UserNo=_curClass.ExecSQL("select_hrKaoqin","@EmpNo="+empNo).value;
            //不为空则是为空则不是
            if (!!UserNo) {
                no = _curClass.ExecSQL("select_qjSum_yjs", keys.join("|")).value;
                $("#input024").val(no);
                //$("#input024").val(no).css("color","blue"); 
            }
            else {
                $("#input024").val(no);
                //$("#input024").val(no).css("color","blue");
            }
        }
    }
}
function isPositiveDirector() {
    if (_nodeCode == "A1") {
        var empNo = '';
        var count = _curClass.ExecSQL("select_PositiveDirector", "@EmployeeCode=" + empNo).value;
        if (count.toString() != '0') {
            return true;
        }
        return false;
    }
    else {
        if (!!$("#input027").val()) {
            return true;
        }
        return false;
    }
    return false;
}
function SummerLeave() {
    var empNo = '';
    if (_sIndex == "4") {
        if (_nodeCode == "A1") {
            //个人请休假显示应有寒暑假              
            var summerleave = _curClass.GetDataTable("select_qj_summerleave", "@empNo=" + empNo).value;
            var summerleavely = _curClass.GetDataTable("select_qj_summerleavely", "@empNo=" + empNo).value;
            var summerleaveny = _curClass.GetDataTable("select_qj_summerleaveny", "@empNo=" + empNo).value;
            //alert(getfloat2(summerleave.Rows[0].SurpSummerLeave));
            //summerleavely = getfloat2(summerleavely);
            //summerleaveny = getfloat2(summerleaveny);
            //当前年             
            if (summerleave.Rows.length > 0) {
                $("#input019").val(summerleave.Rows[0].SummerLeave);
                $("#input020").val(summerleave.Rows[0].SurpSummerLeave);
                $("#input029").val(summerleave.Rows[0].date);
            }
            //上一年
            if (summerleavely.Rows.length > 0) {
                $("#input031").val(summerleavely.Rows[0].SummerLeave);
                $("#input032").val(summerleavely.Rows[0].SurpSummerLeave);
                $("#input030").val(summerleavely.Rows[0].date);
            }
            //下一年
            if (summerleaveny.Rows.length > 0) {
                $("#input034").val(summerleaveny.Rows[0].SummerLeave);
                $("#input035").val(summerleaveny.Rows[0].SurpSummerLeave);
                $("#input033").val(summerleaveny.Rows[0].date);
            }
        }
        if ($("#input031").val().toString() == "" || $("#input031").val().toString() == "0" || $("#input031").val().toString() == "0.0") {
            $(".lastyear").hide();
        }
        else {
            $(".lastyear").show();
        }
        if ($("#input034").val().toString() == "" || $("#input034").val().toString() == "0" || $("#input034").val().toString() == "0.0") {
            $(".nextyear").hide();
        }
        else {
            $(".nextyear").show();
        }
    }
}
function _sysBeforeSave() {
    if (_nodeCode != "A1") {
        return true;
    }
    if (_isNew) {
        qjNo();
    }
    //暂存时不验证
    if (_saveAction == "2") {
        return true;
    }
  	qjSum();
    var empNo = '';
    var qingjiasum = $("#input024").val();
    var days = 0;
    var hours = 0;
    var minutes = 0;
    //是否肝病研究所的员工
    var UserNo = _curClass.ExecSQL("select_yjs", "@EmpNo=" + empNo).value;
    if (qingjiasum.indexOf('天') > -1) {
        days = parseInt(qingjiasum.substr(0, qingjiasum.indexOf('天')));
        qingjiasum = qingjiasum.substr(qingjiasum.indexOf('天') + 1);
    }
    if (qingjiasum.indexOf('小时') > -1) {
        hours = parseInt(qingjiasum.substr(0, qingjiasum.indexOf('小时')));
        qingjiasum = qingjiasum.substr(qingjiasum.indexOf('小时') + 2);
    }
    if (qingjiasum.indexOf('分') > -1) {
        minutes = parseInt(qingjiasum.substr(0, qingjiasum.indexOf('分')));
        qingjiasum = qingjiasum.substr(qingjiasum.indexOf('分') + 1);
    }
    var startDate = $("#input05").val();
    var endDate = $("#input06").val();
    if (startDate == endDate) {
        alert("请假结束时间必须大于请假开始时间！");
        return false;
    }
    if (days == 0 && hours == 0 && minutes == 0) {
        alert("请假时长为0，请重新设置！");
        return false;
    }
    //检查请假时间是否与已有的请假申请重合
    var keys = [];
    keys.push("@empNo=" + empNo);
    keys.push("@begintimeStr=" + startDate);
    keys.push("@endtimeStr=" + endDate);
    keys.push("@autoID=" + _mainId);
    var existoverlap = _curClass.ExecSQL("select_oa_qingjia_existoverlap", keys.join("|")).value;
    if (existoverlap != 0) {
        alert("当前申请的请假时间与已有的请假申请重合！");
        return false;
    }
    if ($("#input013_1")[0].checked == true) {
        alert("外出期间工作安排是否妥当选择“否”，不能提交！");
        return false;
    }
    if (isPositiveDirector()) {
        if (!!$("#input027").val()) {
        }
        else {
            alert("相关工作代理人不能为空！");
            return false;
        }
    }
    if (_sIndex == "4") {
        if (($("#input07_0")[0].checked == false) && ($("#input07_1")[0].checked == false) && ($("#input07_2")[0].checked == false) &&
            ($("#input07_3")[0].checked == false) && ($("#input07_4")[0].checked == false) && ($("#input07_5")[0].checked == false) &&
            ($("#input07_6")[0].checked == false) && ($("#input07_7")[0].checked == false) && ($("#input07_8")[0].checked == false)) {
            alert("请假种类不能为空！");
            return false;
        }
    }
    else {
        if (($("#input07_0")[0].checked == false) && ($("#input07_1")[0].checked == false) && ($("#input07_2")[0].checked == false)) {
            alert("外出事由不能为空！");
            return false;
        }
    }
    if (_sIndex == "4") {
        _fnSubDelAll('OA_QINGJIA_SUMMERLEAVE');//删除子表数据          

        //寒暑假
        if ($("#input07_0")[0].checked == true) {
          	  
            var surpsummerleave = _curClass.ExecSQL("select_qj_surpsummerleave", "@empNo=" + empNo).value;
            var surpsummerleavely = _curClass.ExecSQL("select_qj_surpsummerleavely", "@empNo=" + empNo).value;
            var leavedays = days * 480 + hours * 60 + minutes;
            keys = [];
            keys.push("@d1=" + startDate);
            keys.push("@d2=" + endDate);
            keys.push("@empNo=" + empNo);
            keys.push("@leavedays=" + leavedays);
            var isvalidqingjia = _curClass.ExecSQL("IsValid_SummerLeave_Qingjia", keys.join("|")).value;
            if (isvalidqingjia != "") {
                alert(isvalidqingjia);
                return false;
            }
            keys = [];
            keys.push("@d1=" + startDate);
            keys.push("@d2=" + endDate);
            keys.push("@empNO=" + empNo);
            keys.push("@leavedays=" + leavedays);
            var dtdays = _curClass.GetDataTable("select_summerleave_detail", keys.join("|")).value;
            _fnSubDelAll('OA_QINGJIA_ZBTX');//删除子表数据      
            createSummerLeaveDetail(dtdays);
        }
        //总值班调休假      
        else if ($("#input07_8")[0].checked == true && $("#input022_0")[0].checked == true) {
            var choosedzbplanid = $("#input028").val();
            var choosedzbplanidused = "";
            var beginYmd = startDate.substring(0, 10);
            var endYmd = endDate.substring(0, 10);
            var begintime = startDate.substr(11, 5);
            var endtime = endDate.substr(11, 5);
            keys = [];
            keys.push("@beginYmd=" + beginYmd);
            keys.push("@choosedzbplanid=" + choosedzbplanid);
            keys = [];
            keys.push("@_MainID=" + _mainId);
            keys.push("@choosedzbplanid=" + choosedzbplanid);
            var dthours = _curClass.GetDataTable("select_avaliablezbplanhours", keys.join("|")).value;
            var avaliablehours = dthours.Rows[0].hours;
            if (beginYmd != endYmd) {
                alert("总值班调休假只能选择同一天！");
                return false;
            }
            if (minutes > 0 || (hours != 0 && hours != 4)) {
                alert("总值班调休假只能选择调休1天或半天！");
                return false;
            }
            //总值班只能选择全天，或者上半天，下半天       
            if (!!UserNo) {
                if ((begintime != "08:00" && begintime != "12:30") || (endtime != "12:00" && endtime != "16:30")) {
                    alert("总值班调休假只能选择上半天，下半天，或者全天！");
                    return false;
                }
            }
            else {
                if ((begintime != "08:00" && begintime != "13:00") || (endtime != "12:00" && endtime != "17:00")) {
                    alert("总值班调休假只能选择全天，或者上半天，下半天！");
                    return false;
                }
            }
            var totalhours = days * 8 + hours;
            if (totalhours > avaliablehours) {
                alert("您申请的调休假大于您选择的总值班调休假可休工时！");
                return false;
            }            
            _fnSubDelAll('OA_QINGJIA_ZBTX');//删除子表数据      
            //生成调休明细表        
            keys = [];
            keys.push("@_MainID=" + _mainId);
            keys.push("@_qjdate=" + beginYmd);
            keys.push("@choosedzbplanid=" + choosedzbplanid);
            var dt = _curClass.GetDataTable("select_zbtx_detail", keys.join("|")).value;
            for (var j = 0; j < dt.Rows.length; j++) {
                var dr = dt.Rows[j];
                //如果选择的值班记录已过期或未生效，不能提交，提示重新选择      
                if (dr.isvalid == "0") {
                    alert("您选择的总值班记录在您请假的日期未生效或已过期！请重新选择！");
                    return false;
                }
                keys = [];
                keys.push("@_MainID=" + _mainId);
                keys.push("@choosedzbplanid=" + choosedzbplanid);
                var newIndex = _fnSubAdd("OA_QINGJIA_ZBTX");
                $("#SubTbl01_" + newIndex + "_1").val(dr._AutoID);
                $("#SubTbl01_" + newIndex + "_5").val(dr.areaname);
                $("#SubTbl01_" + newIndex + "_6").val(dr.zbtype);
                $("#SubTbl01_" + newIndex + "_4").val(dr.zbdate);
                $("#SubTbl01_" + newIndex + "_7").val(dr.zbbc);
                $("#SubTbl01_" + newIndex + "_8").val(dr.empname);
                $("#SubTbl01_" + newIndex + "_9").val(dr.signmanname);
                if (j == 0) {
                    choosedzbplanidused = dr._AutoID;
                }
                else {
                    choosedzbplanidused = choosedzbplanidused + "," + dr._AutoID;
                }
                if (dr.hours != 0) {
                    if (dr.hours < totalhours) {
                        $("#SubTbl01_" + newIndex + "_3").val(dr.hours.toString());
                        totalhours = totalhours - dr.hours;
                    }
                    else {
                        $("#SubTbl01_" + newIndex + "_3").val(totalhours.toString());
                        $("#input028").val(choosedzbplanidused);
                        break;
                    }
                    $("#input028").val(choosedzbplanidused);
                }
            }
        }
        else
        {   
            _fnSubDelAll('OA_QINGJIA_ZBTX');//删除子表数据    
        }
    }
    keys = [];
    keys.push("@begintimeStr=" + startDate);
    keys.push("@endtimeStr=" + endDate);
    //生成请假明细表 '@beginTimeStr','@endTimeStr'    
    if (!!UserNo) {
        var dt = _curClass.GetDataTable("select_qjdetail_yjs", keys.join("|")).value;
        createQJDetail(dt);
    }
    else {
        var dt = _curClass.GetDataTable("select_qjdetail", keys.join("|")).value;
        createQJDetail(dt);
    }
    return true;
}
function createQJDetail(dt) {
    //var type = $("#input07").val();  
    var type = "";
    if (_sIndex == "4") {
        for (var i = 0; i <= 8; i++) {
            if ($("#input07_" + i.toString())[0].checked == true) {
                type = $("#input07_" + i.toString()).val();
            }
        }
    }
    else {
        for (var i = 0; i <= 2; i++) {
            if ($("#input07_" + i.toString())[0].checked == true) {
                type = $("#input07_" + i.toString()).val();
            }
        }
    }
    _fnSubDelAll('OA_QINGJIA_DETAIL');//删除子表数据 
    for (var i = 0; i < dt.Rows.length; i++) {
        var dr = dt.Rows[i];
        var newIndex = _fnSubAdd("OA_QINGJIA_DETAIL");
        $("#SubTbl00_" + newIndex + "_1").val(dr.days);
        $("#SubTbl00_" + newIndex + "_2").val(type);
        $("#SubTbl00_" + newIndex + "_3").val(dr.WorkDate);
    }
}
function createSummerLeaveDetail(dt) {
    for (var i = 0; i < dt.Rows.length; i++) {
        var dr = dt.Rows[i];
        var newIndex = _fnSubAdd("OA_QINGJIA_SUMMERLEAVE");
        $("#SubTbl02_" + newIndex + "_1").val(dr._AutoID);
        $("#SubTbl02_" + newIndex + "_2").val(dr.leavedays);
    }
}

function getfloat2(days) {
    if (days.indexOf('.') > -1) {
        days = qingjiasum.substr(0, qingjiasum.indexOf('.') + 3);
    }
    return days;
}
    
    </script>
